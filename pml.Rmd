---
title: "Practical Machine Learning"
author: "Ambu Vijayan"
date: "2023-06-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Predicting Exercise Manner - Project Report
Introduction
The goal of this project is to predict the manner in which participants perform barbell lifts using data collected from accelerometers on different body parts. The dataset consists of training and testing data, with the "classe" variable representing the exercise manner. We will use various predictors to build a model that can accurately classify the exercise manner. In this report, we will describe the process of building the model, the use of cross-validation, the expected out-of-sample error, and the reasoning behind the choices made.

## Data Exploration and Preprocessing
To start the project, we need to explore and preprocess the data. The training and testing datasets are available from the provided URLs. We will use the read.csv function to load the data into R.

```{r Data_Processing, warning=FALSE}
library(ggplot2)
library(caret)

train_url <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv"
test_url <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv"

# Download the data
download.file(train_url, destfile = "pml-training.csv")
download.file(test_url, destfile = "pml-testing.csv")

# Load the training and testing datasets
training_data <- read.table("pml-training.csv", sep = ",", header = TRUE)
testing_data <- read.table("pml-testing.csv", sep = ",", header = TRUE)

# Data Partitioning
set.seed(333)
training_indices <- createDataPartition(y = training_data$classe, p = 0.7, list = FALSE)
training1 <- training_data[training_indices, ]
training2 <- training_data[-training_indices, ]

# Preprocessing - Removing near-zero variance predictors
nzv_columns <- nearZeroVar(training1)
training1 <- training1[, -nzv_columns]
training2 <- training2[, -nzv_columns]

# Preprocessing - Removing columns with NA values
training1 <- training1[, colSums(is.na(training1)) == 0]
training2 <- training2[, colSums(is.na(training2)) == 0]

# Preprocessing - Removing unfit columns
training1 <- training1[, -(1:5)]
training2 <- training2[, -(1:5)]

```

## Model Building and Cross-Validation

```{r Model, cache = TRUE}
# Model Training
model <- train(classe ~., method = "rf", data = training1, verbose = TRUE, trControl = trainControl(method="cv"), number = 3)

# Model Evaluation on training1
predictions_training1 <- predict(model, training1)

# Convert the 'classe' variable to a factor on training1 dataset
training1$classe <- factor(training1$classe)

confusion_matrix_training1 <- confusionMatrix(predictions_training1, training1$classe)

confusion_matrix_training1

plot(confusion_matrix_training1$table, main = "Confusion Matrix for Training Data")

# Model Evaluation on training2
predictions_training2 <- predict(model, training2)

# Convert the 'classe' variable to a factor on training2 dataset
training2$classe <- factor(training2$classe)

confusion_matrix_training2 <- confusionMatrix(predictions_training2, training2$classe)

confusion_matrix_training2

plot(confusion_matrix_training2$table, main = "Confusion Matrix for Validation Data")

```

## Model Evaluation and Prediction with Plots

```{r Evaluation}
# Preprocessing - Removing columns with NA values and unfit columns
testing_data <- testing_data[, colSums(is.na(testing_data)) == 0]
testing_data <- testing_data[, -(1:5)]

# Prediction on test data
predictions_test <- predict(model, testing_data)

predictions_test

# Example Plot 1: Confusion Matrix for training1
plot(confusion_matrix_training1$table, main = "Confusion Matrix for Training Data")

# Example Plot 2: Confusion Matrix for training2
plot(confusion_matrix_training2$table, main = "Confusion Matrix for Validation Data")

# Example Plot 3: Predicted Classes for test data
predictions_df <- data.frame(Exercise_Manner = predictions_test)
ggplot(predictions_df, aes(x = Exercise_Manner)) +
  geom_bar() +
  labs(title = "Predicted Exercise Manner for Test Data",
       x = "Exercise Manner",
       y = "Count")

```

